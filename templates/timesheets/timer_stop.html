{% extends 'base.html' %}

{% block title %}Stop Timer - Trakka{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card border-warning">
            <div class="card-header bg-warning">
                <h4 class="mb-0"><i class="bi bi-stop-circle"></i> Stop Timer</h4>
            </div>
            <div class="card-body">
                <p class="mb-3">Your timer has been running for:</p>

                <div class="text-center mb-4">
                    <h1 class="display-4">{{ timer.elapsed_time }}</h1>
                    <p class="text-muted">{{ timer.duration_minutes }} minutes</p>
                </div>

                <div class="card bg-light mb-3">
                    <div class="card-body">
                        <h6>{{ timer.project.name }}</h6>
                        <p class="mb-0">
                            <strong>Started:</strong> {{ timer.start_time|date:"F d, Y \a\t g:i A" }}
                        </p>
                        {% if timer.description %}
                        <p class="mb-0 mt-2"><strong>Description:</strong> {{ timer.description }}</p>
                        {% endif %}
                    </div>
                </div>

                <p class="text-muted">Stopping the timer will create a time entry with the recorded duration.</p>

                <form method="post">
                    {% csrf_token %}
                    <div class="d-flex justify-content-between">
                        <a href="{% url 'dashboard' %}" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-danger">
                            <i class="bi bi-stop-circle"></i> Stop Timer & Create Entry
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Update timer display every second
let minutes = {{ timer.duration_minutes }};

function updateTimer() {
    minutes++;
    const hours = Math.floor(minutes / 60);
    const mins = minutes % 60;
    const display = String(hours).padStart(2, '0') + ':' + String(mins).padStart(2, '0');

    const displayElement = document.querySelector('.display-4');
    if (displayElement) {
        displayElement.textContent = display;
    }
}

setInterval(updateTimer, 60000); // Update every minute
</script>
{% endblock %}
